{"mappings":"C,A,W,I,E,A,C,A,a,O,W,W,A,a,O,K,K,A,a,O,O,O,A,a,O,O,O,C,C,E,iB,C,A,C,E,E,Q,A,E,Q,S,C,C,C,E,O,c,C,E,O,C,a,C,I,W,O,C,E,I,K,E,W,C,E,a,C,C,G,I,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,SCIE,EAIE,AAAA,EAAA,OAAK,CAJP,cAAA,CACA,EAGE,AAAA,EAAA,OAAK,CAHP,eAAA,CACA,EAEE,AAAA,EAAA,OAAK,CAFP,YAAA,CACA,EACE,AAAA,EAAA,OAAK,CADP,IAJF,CAOQ,EAAS,AAAA,EAAA,MAAK,CAAd,IAAR,CAEM,EAAc,eAAe,IAAI,CAAC,OAAO,WAAW,EAE7C,EAAN,W,aAAM,SAAA,IACE,IAAA,EAAA,UAAA,MAAA,CAAA,GAAA,AAAA,KAAA,IAAA,SAAA,CAAA,EAAA,CAAA,SAAA,CAAA,EAAA,CAAO,SADT,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,IAAA,CAAA,GAET,IAAI,CAAC,IAAI,CAAG,EACZ,IAAI,CAAC,IAAI,CAAG,M,CAHH,MAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,EAAA,C,CAML,IAAA,UAAN,MAAA,W,M,A,C,E,E,C,A,E,W,M,A,C,E,E,W,A,E,I,C,S,C,EACE,KAAM,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAI,EAAa,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAG,G,EAC5B,I,C,E,CAEM,IAAA,cAAN,MAAA,SAAkB,CAAK,E,M,A,C,E,E,C,A,E,W,M,A,C,E,E,W,A,E,I,C,S,C,EACrB,MAAA,C,EAAO,IAAI,GAAK,E,A,EAClB,GAAA,IAAA,CAAA,IAAA,C,C,E,CAKM,IAAA,iBAAN,MAAA,W,M,A,C,E,E,C,A,E,W,IAAsB,EACH,EAAX,EACA,EACA,EACA,EAMA,EAc+B,EAA3B,EAAU,EAEZ,EACA,EAMA,EAqBA,E,E,U,M,A,C,E,E,W,A,E,I,C,S,C,E,O,E,K,E,K,EArDG,OADS,EAAA,EAAA,MAAA,CAAA,GAAA,AAAA,KAAA,IAAA,CAAA,CAAA,EAAA,CAAA,CA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","sources":["<anon>","node_modules/.pnpm/native-file-system-adapter@3.0.1/node_modules/native-file-system-adapter/src/adapters/downloader.js"],"sourcesContent":["(function () {\n\nfunction $parcel$export(e, n, v, s) {\n  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});\n}\n\n      var $parcel$global =\n        typeof globalThis !== 'undefined'\n          ? globalThis\n          : typeof self !== 'undefined'\n          ? self\n          : typeof window !== 'undefined'\n          ? window\n          : typeof global !== 'undefined'\n          ? global\n          : {};\n  var parcelRequire = $parcel$global[\"parcelRequiref23a\"];\nvar parcelRegister = parcelRequire.register;\nparcelRegister(\"BWRo5\", function(module, exports) {\n\n$parcel$export(module.exports, \"FileHandle\", function () { return $07211d341ec9545a$export$8bdd21c705ef8d22; });\n\nvar $hVBqc = parcelRequire(\"hVBqc\");\n\nvar $7lhcp = parcelRequire(\"7lhcp\");\n\nvar $5LayG = parcelRequire(\"5LayG\");\n\nvar $8BtP9 = parcelRequire(\"8BtP9\");\n\nvar $6GCxi = parcelRequire(\"6GCxi\");\n\nvar $fsSDT = parcelRequire(\"fsSDT\");\n\nvar $Csf8W = parcelRequire(\"Csf8W\");\n\nvar $2taKJ = parcelRequire(\"2taKJ\");\n\nvar $cSRQI = parcelRequire(\"cSRQI\");\nvar $07211d341ec9545a$var$WritableStream = (0, $cSRQI.default).WritableStream, $07211d341ec9545a$var$TransformStream = (0, $cSRQI.default).TransformStream, $07211d341ec9545a$var$DOMException = (0, $cSRQI.default).DOMException, $07211d341ec9545a$var$Blob = (0, $cSRQI.default).Blob;\nvar $07211d341ec9545a$var$GONE = (0, $2taKJ.errors).GONE;\n// @ts-ignore - Don't match newer versions of Safari, but that's okay\nvar $07211d341ec9545a$var$isOldSafari = /constructor/i.test(window.HTMLElement);\nvar $07211d341ec9545a$export$8bdd21c705ef8d22 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function FileHandle() {\n        var name = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : 'unkown';\n        (0, $7lhcp._)(this, FileHandle);\n        this.name = name;\n        this.kind = 'file';\n    }\n    (0, $8BtP9._)(FileHandle, [\n        {\n            key: \"getFile\",\n            value: function getFile() {\n                return (/*#__PURE__*/ 0, /*#__PURE__*/ $hVBqc._)(function() {\n                    return (0, $Csf8W.__generator)(this, function(_state) {\n                        throw (0, $5LayG._)($07211d341ec9545a$var$DOMException, (0, $fsSDT._)($07211d341ec9545a$var$GONE));\n                    });\n                })();\n            }\n        },\n        {\n            key: \"isSameEntry\",\n            value: function isSameEntry(other) {\n                return (/*#__PURE__*/ 0, /*#__PURE__*/ $hVBqc._)(function() {\n                    return (0, $Csf8W.__generator)(this, function(_state) {\n                        return [\n                            2,\n                            this === other\n                        ];\n                    });\n                }).call(this);\n            }\n        },\n        {\n            key: \"createWritable\",\n            value: /**\n   * @param {object} [options={}]\n   */ function createWritable() {\n                return (/*#__PURE__*/ 0, /*#__PURE__*/ $hVBqc._)(function() {\n                    var options, _navigator_serviceWorker, sw, link, ts, sink, chunks, _ref, writable, readablePort, fileName, headers, keepAlive, iframe;\n                    var _arguments = arguments;\n                    return (0, $Csf8W.__generator)(this, function(_state) {\n                        switch(_state.label){\n                            case 0:\n                                options = _arguments.length > 0 && _arguments[0] !== void 0 ? _arguments[0] : {};\n                                return [\n                                    4,\n                                    (_navigator_serviceWorker = navigator.serviceWorker) === null || _navigator_serviceWorker === void 0 ? void 0 : _navigator_serviceWorker.getRegistration()\n                                ];\n                            case 1:\n                                sw = _state.sent();\n                                link = document.createElement('a');\n                                ts = new $07211d341ec9545a$var$TransformStream();\n                                sink = ts.writable;\n                                link.download = this.name;\n                                if ($07211d341ec9545a$var$isOldSafari || !sw) {\n                                    /** @type {Blob[]} */ chunks = [];\n                                    ts.readable.pipeTo(new $07211d341ec9545a$var$WritableStream({\n                                        write: function(chunk) {\n                                            chunks.push(new $07211d341ec9545a$var$Blob([\n                                                chunk\n                                            ]));\n                                        },\n                                        close: function() {\n                                            var blob = new $07211d341ec9545a$var$Blob(chunks, {\n                                                type: 'application/octet-stream; charset=utf-8'\n                                            });\n                                            chunks = [];\n                                            link.href = URL.createObjectURL(blob);\n                                            link.click();\n                                            setTimeout(function() {\n                                                return URL.revokeObjectURL(link.href);\n                                            }, 10000);\n                                        }\n                                    }));\n                                } else {\n                                    _ref = new $07211d341ec9545a$var$RemoteWritableStream($07211d341ec9545a$var$WritableStream), writable = _ref.writable, readablePort = _ref.readablePort;\n                                    // Make filename RFC5987 compatible\n                                    fileName = encodeURIComponent(this.name).replace(/['()]/g, escape).replace(/\\*/g, '%2A');\n                                    headers = (0, $6GCxi._)({\n                                        'content-disposition': \"attachment; filename*=UTF-8''\" + fileName,\n                                        'content-type': 'application/octet-stream; charset=utf-8'\n                                    }, options.size ? {\n                                        'content-length': options.size\n                                    } : {});\n                                    keepAlive = setTimeout(function() {\n                                        return sw.active.postMessage(0);\n                                    }, 10000);\n                                    ts.readable.pipeThrough(new $07211d341ec9545a$var$TransformStream({\n                                        transform: function(chunk, ctrl) {\n                                            if (chunk instanceof Uint8Array) return ctrl.enqueue(chunk);\n                                            var reader = new Response(chunk).body.getReader();\n                                            var pump = function(_) {\n                                                return reader.read().then(function(e) {\n                                                    return e.done ? 0 : pump(ctrl.enqueue(e.value));\n                                                });\n                                            };\n                                            return pump();\n                                        }\n                                    })).pipeTo(writable).finally(function() {\n                                        clearInterval(keepAlive);\n                                    });\n                                    // Transfer the stream to service worker\n                                    sw.active.postMessage({\n                                        url: sw.scope + fileName,\n                                        headers: headers,\n                                        readablePort: readablePort\n                                    }, [\n                                        readablePort\n                                    ]);\n                                    // Trigger the download with a hidden iframe\n                                    iframe = document.createElement('iframe');\n                                    iframe.hidden = true;\n                                    iframe.src = sw.scope + fileName;\n                                    document.body.appendChild(iframe);\n                                }\n                                return [\n                                    2,\n                                    sink.getWriter()\n                                ];\n                        }\n                    });\n                }).apply(this, arguments);\n            }\n        }\n    ]);\n    return FileHandle;\n}();\n// Want to remove this postMessage hack, tell them u want transferable streams:\n// https://bugs.webkit.org/show_bug.cgi?id=215485\nvar $07211d341ec9545a$var$WRITE = 0;\nvar $07211d341ec9545a$var$PULL = 0;\nvar $07211d341ec9545a$var$ERROR = 1;\nvar $07211d341ec9545a$var$ABORT = 1;\nvar $07211d341ec9545a$var$CLOSE = 2;\nvar $07211d341ec9545a$var$MessagePortSink = /*#__PURE__*/ function() {\n    \"use strict\";\n    function MessagePortSink(port) {\n        var _this = this;\n        (0, $7lhcp._)(this, MessagePortSink);\n        port.onmessage = function(event) {\n            return _this._onMessage(event.data);\n        };\n        this._port = port;\n        this._resetReady();\n    }\n    (0, $8BtP9._)(MessagePortSink, [\n        {\n            key: \"start\",\n            value: function start(controller) {\n                this._controller = controller;\n                // Apply initial backpressure\n                return this._readyPromise;\n            }\n        },\n        {\n            key: \"write\",\n            value: function write(chunk) {\n                var message = {\n                    type: $07211d341ec9545a$var$WRITE,\n                    chunk: chunk\n                };\n                // Send chunk\n                this._port.postMessage(message, [\n                    chunk.buffer\n                ]);\n                // Assume backpressure after every write, until sender pulls\n                this._resetReady();\n                // Apply backpressure\n                return this._readyPromise;\n            }\n        },\n        {\n            key: \"close\",\n            value: function close() {\n                this._port.postMessage({\n                    type: $07211d341ec9545a$var$CLOSE\n                });\n                this._port.close();\n            }\n        },\n        {\n            key: \"abort\",\n            value: function abort(reason) {\n                this._port.postMessage({\n                    type: $07211d341ec9545a$var$ABORT,\n                    reason: reason\n                });\n                this._port.close();\n            }\n        },\n        {\n            key: \"_onMessage\",\n            value: function _onMessage(message) {\n                if (message.type === $07211d341ec9545a$var$PULL) this._resolveReady();\n                if (message.type === $07211d341ec9545a$var$ERROR) this._onError(message.reason);\n            }\n        },\n        {\n            key: \"_onError\",\n            value: function _onError(reason) {\n                this._controller.error(reason);\n                this._rejectReady(reason);\n                this._port.close();\n            }\n        },\n        {\n            key: \"_resetReady\",\n            value: function _resetReady() {\n                var _this = this;\n                this._readyPromise = new Promise(function(resolve, reject) {\n                    _this._readyResolve = resolve;\n                    _this._readyReject = reject;\n                });\n                this._readyPending = true;\n            }\n        },\n        {\n            key: \"_resolveReady\",\n            value: function _resolveReady() {\n                this._readyResolve();\n                this._readyPending = false;\n            }\n        },\n        {\n            key: \"_rejectReady\",\n            value: function _rejectReady(reason) {\n                if (!this._readyPending) this._resetReady();\n                this._readyPromise.catch(function() {});\n                this._readyReject(reason);\n                this._readyPending = false;\n            }\n        }\n    ]);\n    return MessagePortSink;\n}();\nvar $07211d341ec9545a$var$RemoteWritableStream = function RemoteWritableStream(WritableStream) {\n    \"use strict\";\n    (0, $7lhcp._)(this, RemoteWritableStream);\n    var channel = new MessageChannel();\n    this.readablePort = channel.port1;\n    this.writable = new WritableStream(new $07211d341ec9545a$var$MessagePortSink(channel.port2));\n};\n\n});\n\n})();\n//# sourceMappingURL=downloader.f42adaa9.js.map\n","import { errors } from '../util.js'\nimport config from '../config.js'\n\nconst {\n  WritableStream,\n  TransformStream,\n  DOMException,\n  Blob\n} = config\n\nconst { GONE } = errors\n// @ts-ignore - Don't match newer versions of Safari, but that's okay\nconst isOldSafari = /constructor/i.test(window.HTMLElement)\n\nexport class FileHandle {\n  constructor (name = 'unkown') {\n    this.name = name\n    this.kind = 'file'\n  }\n\n  async getFile () {\n    throw new DOMException(...GONE)\n  }\n\n  async isSameEntry(other) {\n    return this === other\n  }\n\n  /**\n   * @param {object} [options={}]\n   */\n  async createWritable (options = {}) {\n    const sw = await navigator.serviceWorker?.getRegistration()\n    const link = document.createElement('a')\n    const ts = new TransformStream()\n    const sink = ts.writable\n\n    link.download = this.name\n\n    if (isOldSafari || !sw) {\n      /** @type {Blob[]} */\n      let chunks = []\n      ts.readable.pipeTo(new WritableStream({\n        write (chunk) {\n          chunks.push(new Blob([chunk]))\n        },\n        close () {\n          const blob = new Blob(chunks, { type: 'application/octet-stream; charset=utf-8' })\n          chunks = []\n          link.href = URL.createObjectURL(blob)\n          link.click()\n          setTimeout(() => URL.revokeObjectURL(link.href), 10000)\n        }\n      }))\n    } else {\n      const { writable, readablePort } = new RemoteWritableStream(WritableStream)\n      // Make filename RFC5987 compatible\n      const fileName = encodeURIComponent(this.name).replace(/['()]/g, escape).replace(/\\*/g, '%2A')\n      const headers = {\n        'content-disposition': \"attachment; filename*=UTF-8''\" + fileName,\n        'content-type': 'application/octet-stream; charset=utf-8',\n        ...(options.size ? { 'content-length': options.size } : {})\n      }\n\n      const keepAlive = setTimeout(() => sw.active.postMessage(0), 10000)\n\n      ts.readable.pipeThrough(new TransformStream({\n        transform (chunk, ctrl) {\n          if (chunk instanceof Uint8Array) return ctrl.enqueue(chunk)\n          const reader = new Response(chunk).body.getReader()\n          const pump = _ => reader.read().then(e => e.done ? 0 : pump(ctrl.enqueue(e.value)))\n          return pump()\n        }\n      })).pipeTo(writable).finally(() => {\n        clearInterval(keepAlive)\n      })\n\n      // Transfer the stream to service worker\n      sw.active.postMessage({\n        url: sw.scope + fileName,\n        headers,\n        readablePort\n      }, [readablePort])\n\n      // Trigger the download with a hidden iframe\n      const iframe = document.createElement('iframe')\n      iframe.hidden = true\n      iframe.src = sw.scope + fileName\n      document.body.appendChild(iframe)\n    }\n\n    return sink.getWriter()\n  }\n}\n\n// Want to remove this postMessage hack, tell them u want transferable streams:\n// https://bugs.webkit.org/show_bug.cgi?id=215485\n\nconst WRITE = 0\nconst PULL = 0\nconst ERROR = 1\nconst ABORT = 1\nconst CLOSE = 2\n\nclass MessagePortSink {\n  /** @param {MessagePort} port */\n  constructor (port) {\n    port.onmessage = event => this._onMessage(event.data)\n    this._port = port\n    this._resetReady()\n  }\n\n  start (controller) {\n    this._controller = controller\n    // Apply initial backpressure\n    return this._readyPromise\n  }\n\n  write (chunk) {\n    const message = { type: WRITE, chunk }\n\n    // Send chunk\n    this._port.postMessage(message, [chunk.buffer])\n\n    // Assume backpressure after every write, until sender pulls\n    this._resetReady()\n\n    // Apply backpressure\n    return this._readyPromise\n  }\n\n  close () {\n    this._port.postMessage({ type: CLOSE })\n    this._port.close()\n  }\n\n  abort (reason) {\n    this._port.postMessage({ type: ABORT, reason })\n    this._port.close()\n  }\n\n  _onMessage (message) {\n    if (message.type === PULL) this._resolveReady()\n    if (message.type === ERROR) this._onError(message.reason)\n  }\n\n  _onError (reason) {\n    this._controller.error(reason)\n    this._rejectReady(reason)\n    this._port.close()\n  }\n\n  _resetReady () {\n    this._readyPromise = new Promise((resolve, reject) => {\n      this._readyResolve = resolve\n      this._readyReject = reject\n    })\n    this._readyPending = true\n  }\n\n  _resolveReady () {\n    this._readyResolve()\n    this._readyPending = false\n  }\n\n  _rejectReady (reason) {\n    if (!this._readyPending) this._resetReady()\n    this._readyPromise.catch(() => {})\n    this._readyReject(reason)\n    this._readyPending = false\n  }\n}\n\nclass RemoteWritableStream {\n  constructor (WritableStream) {\n    const channel = new MessageChannel()\n    this.readablePort = channel.port1\n    this.writable = new WritableStream(\n      new MessagePortSink(channel.port2)\n    )\n  }\n}\n"],"names":["parcelRequire","$parcel$global","globalThis","self","window","global","parcelRegister","register","module","exports","Object","defineProperty","get","$07211d341ec9545a$export$8bdd21c705ef8d22","set","s","enumerable","configurable","$hVBqc","$7lhcp","$5LayG","$8BtP9","$6GCxi","$fsSDT","$Csf8W","$2taKJ","$cSRQI","$07211d341ec9545a$var$WritableStream","default","WritableStream","$07211d341ec9545a$var$TransformStream","TransformStream","$07211d341ec9545a$var$DOMException","DOMException","$07211d341ec9545a$var$Blob","Blob","$07211d341ec9545a$var$GONE","errors","GONE","$07211d341ec9545a$var$isOldSafari","test","HTMLElement","FileHandle","name","arguments","length","_","kind","key","value","__generator","_state","other","call","options","_navigator_serviceWorker","sw","link","ts","sink","chunks","_ref","writable","readablePort","fileName","headers","keepAlive","iframe","_arguments","label","navigator","serviceWorker","getRegistration","sent","document","createElement","download","readable","pipeTo","write","chunk","push","close","blob","type","href","URL","createObjectURL","click","setTimeout","revokeObjectURL","$07211d341ec9545a$var$RemoteWritableStream","encodeURIComponent","replace","escape","size","active","postMessage","pipeThrough","transform","ctrl","Uint8Array","enqueue","reader","Response","body","getReader","pump","read","then","e","done","finally","clearInterval","url","scope","hidden","src","appendChild","getWriter","apply","$07211d341ec9545a$var$MessagePortSink","MessagePortSink","port","_this","onmessage","event","_onMessage","data","_port","_resetReady","controller","_controller","_readyPromise","buffer","reason","message","_resolveReady","_onError","error","_rejectReady","Promise","resolve","reject","_readyResolve","_readyReject","_readyPending","catch","RemoteWritableStream","channel","MessageChannel","port1","port2"],"version":3,"file":"downloader.f42adaa9.js.map"}